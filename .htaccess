##
# OpenCart SEO-Friendly URL Rewrite Rules
# Supports both localhost subfolder installs and production root installs
# Version: Enhanced SEO
##

RewriteEngine On

# ------------------------------------------------------------
# Dynamic RewriteBase Detection
# Automatically detects the base path for subfolder installs
# ------------------------------------------------------------
# For localhost subfolder: /www/opencartly/ or /opencartly/
# For production root: / (no rewrite base needed)
# ------------------------------------------------------------
<IfModule mod_rewrite.c>
  RewriteBase /
</IfModule>

# ------------------------------------------------------------
# Get the base directory from the Request URI
# This allows automatic RewriteBase detection for subfolder installs
# ------------------------------------------------------------
RewriteCond %{REQUEST_URI}::$1 ^(.*?/)(.*)::\2$
RewriteRule ^(.*)$ - [E=BASE:%1]

# ------------------------------------------------------------
# üõ° Security rules
# ------------------------------------------------------------
<FilesMatch "(?i)((\.tpl|\.twig|\.ini|\.log|(?<!robots)\.txt))">
  Require all denied
</FilesMatch>

<IfModule mod_autoindex.c>
  IndexIgnore *
</IfModule>

<IfModule mod_headers.c>
  Header always set X-Content-Type-Options "nosniff"
  Header always set Referrer-Policy "no-referrer"
  Header always set Permissions-Policy "interest-cohort=()"
</IfModule>

# ------------------------------------------------------------
# ‚ùå Block direct access to system/
# ------------------------------------------------------------
RewriteRule ^system/(.*) index.php?route=error/not_found [L]

# ------------------------------------------------------------
# üöÄ 301 Redirect: Remove /catalog/, /information/ prefixes from URLs
# This creates clean SEO-friendly URLs
# ------------------------------------------------------------
# Redirect old URLs like /catalog/product-name/ to /product-name/
# Redirect old URLs like /information/about-us/ to /about-us/
# Works for all language routes (e.g., /en-gb/catalog/..., /fr-fr/catalog/...)
# ------------------------------------------------------------
RewriteCond %{REQUEST_URI} ^/(.*/)?catalog/(.+)$ [NC]
RewriteRule ^(.*/)?catalog/(.+)$ /%1$2 [R=301,L]

RewriteCond %{REQUEST_URI} ^/(.*/)?information/(.+)$ [NC]
RewriteRule ^(.*/)?information/(.+)$ /%1$2 [R=301,L]

RewriteCond %{REQUEST_URI} ^/(.*/)?product/(.+)$ [NC]
RewriteRule ^(.*/)?product/(.+)$ /%1$2 [R=301,L]

RewriteCond %{REQUEST_URI} ^/(.*/)?category/(.+)$ [NC]
RewriteRule ^(.*/)?category/(.+)$ /%1$2 [R=301,L]

# ------------------------------------------------------------
# üß± Prevent rewrite recursion
# ------------------------------------------------------------
RewriteCond %{ENV:REDIRECT_STATUS} 200
RewriteRule .* - [L]

# ------------------------------------------------------------
# ‚úÖ Main SEO URL rewrite
# Enables clean URLs like /about-us or /laptops
# ------------------------------------------------------------
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^([^?]*) index.php?_route_=$1 [L,QSA]

# ------------------------------------------------------------
# Optional custom error pages
# Uncomment if you want custom error handling
# ------------------------------------------------------------
#ErrorDocument 404 /index.php?route=error/not_found
#ErrorDocument 500 /index.php?route=error/not_found
