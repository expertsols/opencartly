##
# READ THIS COMPLETELY IF YOU CHOOSE TO USE THIS FILE!
#
# 1.To use URL Alias you need to be running apache with mod_rewrite enabled.
# 2. In your opencart directory rename .htaccess.txt (this file) to .htaccess
#
# For any support issues please visit: https://www.opencart.com
#
# The line 'Options +FollowSymLinks' may cause problems with some server configurations.
# It is required for the use of Apache mod_rewrite, but it may have already been set by
# your server administrator in a way that disallows changing it in this .htaccess file.
# If you encounter problems (e.g. site is not loading), comment out this line by adding a # in front
# FLOC is a feature suggested by Google, if this header shall not be set, disable the line
# having 'interest-cohort' by adding a # in front
##

## No directory listings
<IfModule mod_autoindex.c>
  IndexIgnore *
</IfModule>

## No-Referrer-Header
<IfModule mod_headers.c>
  Header set Referrer-Policy "no-referrer"
</IfModule>

## Suppress mime type detection in browsers for unknown types and prevent FLOC
<IfModule mod_headers.c>
  Header always set X-Content-Type-Options "nosniff"
  Header always set Permissions-Policy "interest-cohort=()"
</IfModule>

## Can be commented out if causes errors, see notes above.
Options +FollowSymlinks

## Prevent Directory listing
Options -Indexes

## Prevent Direct Access to files
<FilesMatch "(?i)((\.tpl|\.twig|\.ini|\.log|(?<!robots)\.txt))">
 Require all denied
## For apache 2.2 and older, replace "Require all denied" with these two lines :
# Order deny,allow
# Deny from all
</FilesMatch>

## SEO URL Settings
RewriteEngine On

## If your opencart installation does not run on the main web folder make sure you folder it does run in (ie). / becomes /static/html/
RewriteBase /www/opencartly/

# Rewrite Rules
# Create environmental variable called rewrite path to store the path if the store is in a seperate folder
RewriteRule ^(.+)$ - [E=REWRITE_PATH:$1,C]
RewriteRule ^system/(.*) index.php?route=error/not_found [L]

# Try to load the html from the /static/html/ and not have it generated by PHP if the URL starts with language code
RewriteCond %{QUERY_STRING} ^$
RewriteCond %{ENV:REWRITE_PATH} ^([a-z]{2}-[a-z]{2}\/)|^$
RewriteCond %{REQUEST_FILENAME} ^(.+\/)
RewriteCond %1static/html/%{HTTP_HOST}/%{ENV:REWRITE_PATH}index.html -f
RewriteRule ^(.+)$ static/html\/%{HTTP_HOST}\/%{ENV:REWRITE_PATH} [L,QSA]

# Redirect any requests to index.php so the pages can be generated and cached
RewriteCond %{ENV:REWRITE_PATH} ^([a-z]{2}-[a-z]{2}\/)|^$
RewriteCond %{REQUEST_FILENAME} ^(.+\/)
RewriteRule ^(.+)$ index\.php?_route_=%{ENV:REWRITE_PATH} [L,QSA]

## Optional error documents
#ErrorDocument 400 /index.php?route=error/not_found
#ErrorDocument 401 /index.php?route=error/permission
#ErrorDocument 403 /index.php?route=error/not_found
#ErrorDocument 404 /index.php?route=error/not_found
#ErrorDocument 500 /index.php?route=error/not_found
#ErrorDocument 503 /index.php?route=error/not_found
